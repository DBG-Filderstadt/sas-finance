<!doctype html>
<html lang="en">
  <%- include('partials/header.ejs') %>
  <body onload="load()">
    <%- include('partials/navbar.ejs') %>

    <div class="container-fluid">
      <div class="row">
        <%- include('partials/sideboard.ejs') %>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
            <h1 class="h2">Users</h1>
            <div class="btn-toolbar mb-2 mb-md-0">

              <input type="text" class="form-control" id="searchuser" oninput="searchuser();" placeholder="User suchen" aria-label="User suchen">
              
            </div>
          </div>


         

          <h2>Alle Benutzer</h2>
          <div class="table-responsive">
            <table class="table table-striped table-sm">
              <thead>
                <tr>
                  <th>id</th>
                  <th>Name</th>
                  <th>Klasse</th>
                  <th>RFID</th>
                  <th>Balance</th>
                  <th>Company</th>
                  <th>Rolle</th>
                  <th>Gesperrt</th>
                </tr>
              </thead>
              <tbody id="test">

                <% for(var i=0; i<users.length; i++) { %>
                  <tr>
                     <td><%= users[i].id%></td>
                     <td><a style="text-decoration: none; color:rgb(44, 44, 44);font-weight: bold;" href="/admin/user/<%=users[i].chipID%>"><%= users[i].name%></a></td>
                     <td><%= users[i].class%></td>
                     <td><%= users[i].chipID%></td>
                     <td><%= users[i].balance%></td>
                     <td><%= users[i].company%></td>
                     <td><%= users[i].role%></td>
                     <td><%= users[i].isLocked%></td>
                 </tr>        
                <% } %>
              </tbody>
            </table>
          </div>
        </main>
      </div>
    </div>

    <script>
      function dialog() {
        window.prompt("Please enter the userIUD:", "userID")
      }

      function searchuser() {
        var input = document.getElementById("searchuser").value;
        var tbody = document.getElementById("test");

        if (input == "") {
          return;
        }
        const xhttp = new XMLHttpRequest();
        xhttp.open("GET", "../user/search/" + input, true);
        xhttp.send();
        
        xhttp.onload = function () {
          tbody.innerHTML = ''
          let output = JSON.parse(this.response);
          for(var i=0; i<output.length; i++) {
            tbody.innerHTML += '<tr><td>' + output[i].id + '</td><td>' + output[i].name + '</td><td>' + output[i].class + '</td><td>' + output[i].chipID + '</td><td>' + output[i].balance + '</td><td>' + output[i].company + '</td><td>' + output[i].role + '</td><td>' + output[i].isLocked + '</td></tr>';  
          } 
        }
      }
      function load() {
        document.getElementById("searchuser").value = "";
        document.getElementById("searchuser").focus();
      }
    </script>

    <%- include('partials/bottom.ejs') %>
  </body>
</html>
